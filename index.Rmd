---
title: "The p-value"
author: "Stefano Coretta"
date: "2021/07/21"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 16:9
      beforeInit: "macros.js"
    css: ["default", "shinobi", "metropolis-fonts"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(htmltools.dir.version = FALSE)
library(tidyverse)
theme_set(theme_minimal())
```

```{r xaringanExtra, echo=FALSE}
xaringanExtra::use_xaringan_extra(c("tachyons"))
```

class: center middle

![:scale 125%](img/nhst-p-value.png)

???

Image we want to know if the colour of a light a plant is exposed to has an effect on the rate of growth of the plant.

So we ran an experiment: a group of plants were exposed to red light and another group was exposed to blue light.

After a month, we measured the height of the plants in the two groups and we found that the plants exposed to the blue light are on average 2 cm taller than the plants exposed to the red light.

We then ran a statistical test which returned a *p*-value ($p = 0.03$)

What does the *p*-value mean?

---

class: center middle

![](img/nhst-replicate-1.png)

???

Let's step back a moment.

In this experiment we got a result of +2cm.

But this is just ONE experiment.

---

class: center middle

![](img/nhst-replicate-2.png)
???

So, now we want to know whether the result we observed in this experiment would be observed again if we ran many more identical experiments (say, 100 experiments more).

---

class: center middle

![](img/nhst-replicate-3.png)

???

We want to know that because it is possible that we got +2cm in this experiment, but we could get 0 in any other repetition of the experiment.

And we don't want this to happen! (That we find a difference of 2cm while in reality there is no difference)

---

class: center middle

![:scale 70%](img/nhst-assume-null.png)

???

So what we do is, we assume that in fact there is no difference (i.e. colour of light does NOT affect plant growth).

---

class: center middle

```{r null-probs, fig.width=13, fig.height=7}
x <- seq(-4, 4, by = 0.01)
y <- dnorm(x)

labels <- tibble(
  x = c(0,  -2.5, 2),
  y = c(-0.025, 0.36, 0.1),
  labs = c("0", "high probability", "low probability")
)

arrows <- tibble(
  x1 = c(-1.5, 2.5),
  y1 = c(0.4 - 0.025, 0.1 - 0.025),
  x2 = c(-0.4, 3),
  y2 = c(0.4 - 0.015, 0.025)
)

ggplot() +
  aes(x, y) +
  geom_ribbon(aes(ymin = 0, ymax = y), fill = "#7570b3", alpha = 0.4) +
  geom_segment(aes(x = 0, y = 0, xend = 0, yend = max(y)), colour = "#1b9e77", size = 3) +
  geom_text(data = labels, aes(x, y, label = labs), size = 15, family = "Brandon Grotesque Medium") +
  geom_curve(
    data = arrows, aes(x = x1, y = y1, xend = x2, yend = y2),
    arrow = arrow(length = unit(0.3, "inch"), type = "closed"), size = 1,
    color = "gray20", curvature = -0.3
  ) +
  theme_void()
```

???

If the null hypothesis is true, then observing no difference between plants exposed to red or blue light is very probable.

On the other hand, observing differences that are further away from 0 (in the positive and negative side) is very unlikely (it has very low probability of occurring).

---

class: center middle

```{r rare-events, fig.width=13, fig.height=7}
x <- seq(-4, 4, by = 0.01)
y <- dnorm(x)

labels <- tibble(
  x = c(0, 1.5, -2.5, 3),
  y = c(-0.025, -0.025, 0.36, 0.15),
  labs = c("0", "bigger positive differences ->", "high probability", "RARE\nEVENTS")
)

arrows <- tibble(
  x1 = c(-1.5, 3),
  y1 = c(0.4 - 0.025, 0.1 - 0.025),
  x2 = c(-0.4, 3),
  y2 = c(0.4 - 0.015, 0.025)
)

ggplot() +
  aes(x, y) +
  geom_ribbon(aes(ymin = 0, ymax = y), fill = "#7570b3", alpha = 0.4) +
  geom_segment(aes(x = 0, y = 0, xend = 0, yend = max(y)), colour = "#1b9e77", size = 3) +
  geom_text(data = labels, aes(x, y, label = labs), size = c(15, 8, 15, 16), family = "Brandon Grotesque Medium", colour = c("black", "#d95f02", "black", "#d95f02")) +
  geom_curve(
    data = arrows, aes(x = x1, y = y1, xend = x2, yend = y2),
    arrow = arrow(length = unit(0.3, "inch"), type = "closed"), size = 1,
    color = c("gray20", "#d95f02"), curvature = -0.3
  ) +
  theme_void()
```

???

In other words, if it is true that there is no difference, observing big differences is a rare event.

So, $p$ is the probability of finding a certain difference or even a bigger difference even though there is in fact no difference.

We want that probability to be as low as possible.

---

class: center middle

```{r p-value, fig.width=13, fig.height=7}
x <- seq(-4, 4, by = 0.01)
y <- dnorm(x)

labels <- tibble(
  x = c(0, qnorm(0.03, lower.tail = FALSE), -2.5, 3),
  y = c(-0.025, -0.025, 0.36, 0.1),
  labs = c("0", "+2cm", "high probability", "p = 0.03")
)

arrows <- tibble(
  x1 = c(-1.5, 3),
  y1 = c(0.4 - 0.025, 0.1 - 0.025),
  x2 = c(-0.4, 2.1),
  y2 = c(0.4 - 0.015, 0)
)

ggplot() +
  aes(x, y) +
  geom_ribbon(aes(ymin = 0, ymax = y), fill = "#7570b3", alpha = 0.4) +
  geom_segment(aes(x = 0, y = 0, xend = 0, yend = max(y)), colour = "#1b9e77", size = 3) +
  geom_text(data = labels, aes(x, y, label = labs), size = c(15, 15, 15, 16), family = "Brandon Grotesque Medium", colour = c("black", "black", "black", "#d95f02")) +
  geom_curve(
    data = arrows, aes(x = x1, y = y1, xend = x2, yend = y2),
    arrow = arrow(length = unit(0.3, "inch"), type = "closed"), size = 1,
    color = c("gray20", "#d95f02"), curvature = -0.3
  ) +
  annotate("point", x = qnorm(0.03, lower.tail = FALSE), y = 0, size = 8) +
  theme_void()
```


???

The probability of finding a difference of +2cm when there is no difference is 0.03, in other words 3% probability.

We want that probability to be as low as possible, but how low is low?

We will talk about this and other aspects of p-values in our next class!
