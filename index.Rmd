---
title: "The p-value"
author: "Stefano Coretta"
date: "2021/07/21"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 16:9
      beforeInit: "macros.js"
    css: ["default", "shinobi", "metropolis-fonts", "extra.css"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(htmltools.dir.version = FALSE)
library(tidyverse)
theme_set(theme_minimal())
```

```{r xaringanExtra, echo=FALSE}
xaringanExtra::use_xaringan_extra(c("tachyons"))
```

# From research question to p-value

<br>

.center[![:scale 30%](img/mars.png)]

???

Let's imagine we want to more to Mars and grow crops and plants.

Given the predominant colour of Mars, we wonder whether the light of the planet will have an effect on plant growth.

---

# From research question to p-value

<br>

<br>

<br>

![:scale 125%](img/nhst-p-value-1.png)

???

So now we want to know if the colour of the light a plant is exposed to has an effect on the rate of growth of the plant.

---

# From research question to p-value

<br>

<br>

<br>

![:scale 125%](img/nhst-p-value-2.png)

???

So we run an experiment: a group of plants is exposed to red light and another group is exposed to blue light.

---

# From research question to p-value

<br>

<br>

<br>

![:scale 125%](img/nhst-p-value-3.png)

???

After a month of exposure, we measure the height of the plants in the two groups and we find that the plants exposed to the blue light are on average 2 cm taller than the plants exposed to the red light.

---

# From research question to p-value

<br>

<br>

<br>

![:scale 125%](img/nhst-p-value-4.png)

???

We run a statistical test which returns a *p*-value. More precisely, $p = 0.03$.

But what does the *p*-value mean?

---

class: center middle

![](img/nhst-replicate-1.png)

???

Let's step back a moment.

In this experiment we got a result of +2cm (plants exposed to blue light were 2 cm taller than plants exposed to red light).

But this is just ONE experiment of many.

---

class: center middle

![](img/nhst-replicate-2.png)

???

So, now we want to know whether the result we observed in this one experiment would be observed again if we ran many more identical experiments.

---

class: center middle

![](img/nhst-replicate-3.png)

???

We want to know this because it is possible that, although we observed a difference of +2 cm in this experiment, we might have observed no difference (i.e. difference = 0 cm) in any other repetition of the experiment.

And we don't want this to happen! (We don't want to find a difference of +2 cm while in fact there is no difference)

---

class: center middle

![:scale 70%](img/nhst-assume-null.png)

???

So this is what we do.

We assume that indeed there is in fact no difference (i.e. colour of light does NOT affect plant growth).

This is call the NULL HYPOTHESIS and we assume that it is true.

---

class: center middle

```{r null-probs, fig.width=13, fig.height=7}
x <- seq(-4, 4, by = 0.01)
y <- dnorm(x)

labels <- tibble(
  x = c(0,  -2.5, 2),
  y = c(-0.025, 0.36, 0.1),
  labs = c("0", "high probability", "low probability")
)

arrows <- tibble(
  x1 = c(-1.5, 2.5),
  y1 = c(0.4 - 0.025, 0.1 - 0.025),
  x2 = c(-0.4, 3),
  y2 = c(0.4 - 0.015, 0.025)
)

ggplot() +
  aes(x, y) +
  geom_ribbon(aes(ymin = 0, ymax = y), fill = "#7570b3", alpha = 0.4) +
  geom_segment(aes(x = 0, y = 0, xend = 0, yend = max(y)), colour = "#1b9e77", size = 3) +
  geom_text(data = labels, aes(x, y, label = labs), size = 15, family = "Brandon Grotesque Medium") +
  geom_curve(
    data = arrows, aes(x = x1, y = y1, xend = x2, yend = y2),
    arrow = arrow(length = unit(0.3, "inch"), type = "closed"), size = 1,
    color = "gray20", curvature = -0.3
  ) +
  theme_void()
```

???

If the null hypothesis is true, then observing no difference between plants exposed to red or blue light is very probable, i.e. observing no difference has high probability.

On the other hand, observing differences that are further away from 0 (in the positive and negative side) is very unlikely (it has very low probability of occurring).

---

class: center middle

```{r rare-events, fig.width=13, fig.height=7}
x <- seq(-4, 4, by = 0.01)
y <- dnorm(x)

labels <- tibble(
  x = c(0, 1.5, -2.5, 3),
  y = c(-0.025, -0.025, 0.36, 0.15),
  labs = c("0", "bigger positive differences ->", "high probability", "RARE\nEVENTS")
)

arrows <- tibble(
  x1 = c(-1.5, 3),
  y1 = c(0.4 - 0.025, 0.1 - 0.025),
  x2 = c(-0.4, 3),
  y2 = c(0.4 - 0.015, 0.025)
)

ggplot() +
  aes(x, y) +
  geom_ribbon(aes(ymin = 0, ymax = y), fill = "#7570b3", alpha = 0.4) +
  geom_segment(aes(x = 0, y = 0, xend = 0, yend = max(y)), colour = "#1b9e77", size = 3) +
  geom_text(data = labels, aes(x, y, label = labs), size = c(15, 8, 15, 16), family = "Brandon Grotesque Medium", colour = c("black", "#d95f02", "black", "#d95f02")) +
  geom_curve(
    data = arrows, aes(x = x1, y = y1, xend = x2, yend = y2),
    arrow = arrow(length = unit(0.3, "inch"), type = "closed"), size = 1,
    color = c("gray20", "#d95f02"), curvature = -0.3
  ) +
  theme_void()
```

???

In other words, if it is true that there is no difference, observing big differences should be a rare event.

So, a $p$-value is the probability of finding a certain difference or an even bigger difference even though there is in fact no difference (i.e. the null hypothesis is true).

We want that probability to be as low as possible.

---

class: center middle

```{r p-value, fig.width=13, fig.height=7}
x <- seq(-4, 4, by = 0.01)
y <- dnorm(x)

labels <- tibble(
  x = c(0, qnorm(0.03, lower.tail = FALSE), -2.5, 3),
  y = c(-0.025, -0.025, 0.36, 0.1),
  labs = c("0", "+2cm", "high probability", "p = 0.03")
)

arrows <- tibble(
  x1 = c(-1.5, 3),
  y1 = c(0.4 - 0.025, 0.1 - 0.025),
  x2 = c(-0.4, 2.1),
  y2 = c(0.4 - 0.015, 0)
)

ggplot() +
  aes(x, y) +
  geom_ribbon(aes(ymin = 0, ymax = y), fill = "#7570b3", alpha = 0.4) +
  geom_segment(aes(x = 0, y = 0, xend = 0, yend = max(y)), colour = "#1b9e77", size = 3) +
  geom_text(data = labels, aes(x, y, label = labs), size = c(15, 15, 15, 16), family = "Brandon Grotesque Medium", colour = c("black", "black", "black", "#d95f02")) +
  geom_curve(
    data = arrows, aes(x = x1, y = y1, xend = x2, yend = y2),
    arrow = arrow(length = unit(0.3, "inch"), type = "closed"), size = 1,
    color = c("gray20", "#d95f02"), curvature = -0.3
  ) +
  annotate("point", x = qnorm(0.03, lower.tail = FALSE), y = 0, size = 8) +
  theme_void()
```


???

The probability of finding a difference of +2 cm or an even bigger difference when in fact there is no difference is 0.03, in other words observing a +2 cm difference or a bigger difference has 3% probability of occurring if the null hypothesis is true.

In principle, we want that probability to be as low as possible, but in practice?

We will talk about this and other aspects of p-values in our next class!
